<html>
<head>
<script src="http://code.jquery.com/jquery-1.11.3.min.js" type="text/javascript"></script>
<link rel="stylesheet" type="text/css" href="app.css">
</head>
<body>
    <div id="rssdata">
    <div class="rss-items"></div>
    <div class="loading">Loading RSS items...</div>
    </div>
    <div class="weather_area">
        <div class="temp_section">
            <p class="main_temp"></p>
            <p class="feels_temp"></p>
            <p class="weatherdesc_section" style="font-size:32px;"></p>
        </div>
    </div>
    <div class="nav_area">
        <input name="stepfx" type="text" value="1" />
        <div class="prev_button"></div>
        <div class="next_button running"></div>
    </div>
</body>
<script type="text/javascript" src="https://rss2json.com/gfapi.js"></script>
<script type="text/javascript">
$(document).ready(function() {
    $('.nav_area .prev_button').click(function(e) {
        $('input[name=stepfx]').val(-1);
        $('.nav_area .next_button').removeClass('running');
        $(this).addClass('running');
    });
    $('.nav_area .next_button').click(function(e) {
        $('input[name=stepfx]').val(1);
        $('.nav_area .prev_button').removeClass('running');
        $(this).addClass('running');
    });
});

function getData() {
  var dataUrls = [
    "https://www.straitstimes.com/news/singapore/rss.xml",
    "https://www.channelnewsasia.com/rssfeeds/8395986"
  ];

  dataUrls.forEach(function(dataUrl) {
    getDataFromUrl(dataUrl);
  });
}

function getDataFromUrl(feedUrl) {
  //var feedUrl = "https://www.straitstimes.com/news/singapore/rss.xml";
  var feed = new google.feeds.Feed(feedUrl);
  feed.load(function(result) {
    if (!result.error) {
      //console.log("load feed", result.feed.entries);
      populateDataOnPage(result.feed.entries);
      return result.feed.entries;
    } else {
      return [];
    }
  });
}

function populateDataOnPage(data) {
  var container = document.getElementById("rssdata");
  console.log(data);
  for (var i = 0; i < data.length; i++) {
    var entry = data[i];
    var div = document.createElement("div");
    div.appendChild(document.createTextNode(entry.title));
    container.appendChild(div);
  }
}

$('#rssdata').ready(function () {
    google.load("feeds", "1");
    google.setOnLoadCallback(getData);
    


/*$.when(
    $.ajax({
        url: 'http://ajax.googleapis.com/ajax/services/feed/load?v=1.0&num=15&q=http://www.channelnewsasia.com/starterkit/servlet/cna/rss/home.xml',
        dataType: 'jsonp',
        crossDomain: true,
        success: function (data) {
            $(data.responseData.feed.entries).each(function (index, entry) {
                var item_html = '<div class=""><a target="_blank" href="' + entry.link + '">' + entry.title + '</a><div class="durationbar"></div><p>'+ entry.content +'</p></div>';
                $('#rssdata .rss-items').append(item_html);
            });
        },
        error: function () {}

    }),
    $.ajax({
        url: 'http://ajax.googleapis.com/ajax/services/feed/load?v=1.0&num=15&q=http://dribbble.com/shots/popular.rss',
        dataType: 'jsonp',
        crossDomain: true,
        success: function (data) {
            $(data.responseData.feed.entries).each(function (index, entry) {
                var item_html = '<div class=""><a target="_blank" href="' + entry.link + '">' + entry.title + '</a><div class="durationbar"></div><p>'+ entry.content +'</p></div>';
                $('#rssdata .rss-items').append(item_html);
            });
        },
        error: function () {}

    })
).done(function() {

    $('#rssdata div.loading').fadeOut();
    $('#rssdata .rss-items').slideDown();

    if ( refreshItem ) clearInterval(refreshItem);
    var refreshItem; var stepfx; var currItem = 1; var totalItem = $('#rssdata .rss-items > div').length;

    refreshItem = setInterval(function() {
        stepfx = Number( $('input[name=stepfx]').val() );
        currItem = ((currItem + stepfx) % totalItem);
        if (currItem == 0) currItem = totalItem;

        var toppos = $('#rssdata .rss-items > div:nth-child('+ currItem +')').position().top;

        $('#rssdata .rss-items').css('top',0-toppos);

    }, 8000);

});*/
});
</script>
</html>
